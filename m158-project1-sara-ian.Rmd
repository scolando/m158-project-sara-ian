---
title: "An Analysis of NHANES Data"
output: pdf_document
author: "Sara Colando and Ian Horsburgh"
date: "22 February 2022"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, warning = FALSE,
                      fig.width = 5, fig.height = 3.5, 
                      fig.align = 'center')

library(tidyverse)
library(broom)
library(tidymodels)
library(mosaic)
library(NHANES)
library(nhanesA)
library(skimr)
```

# Introduction

  The National Health and Nutrition Exam Survey (NHANES) is administered by the National Center for Health Statistics, which is a branch of the Center for Disease Control in the United States. The target population of NHANES is people who live in the United States (of any age). Each year, NHANES randomly selects 7,000 residents in the US to participate in NHANES. The participation of those selected is confidential and voluntary. Once selected residents opt-in to NHANES, they undergo a personal interview and “standardized health examination”, where researchers can collect health information.

  The NHANES data that we are analyzing has 10,000 observations and 75 variables which were collected from 2009-2012. The observational unit is a resident of the United States that is six months or older. For our project, we will only be using 10 variables – x quantitative and y categorical – that are listed below.

LIST HERE

  Our response variable is pulse – which is the 60 second pulse rate of a participant. 
  
  Given many of our variables (such as ___) were only collected for participants 18 and older, we will be limiting the scope of our population to adults (>18 years old) who live in the US.


### Age (quantitative)
- Age in years at screening of study participant. All subjects 80 and older were recorded as 80.

### Testosterone (quantitative)
- Testosterone total (ng/dL), recorded for patients 6 and older. Note that no testosterone data for 2009-2010 was recorded.

### Physactivedays (numerical discrete)
- Number of days in a typical week that partipant does moderate or vigorous-intensity activity. Reported in patients 12 years or older.

### Pulse (quantitative)
- 60 second pulse rate

### Gender (categorical)
- Gender (sex) of study particpant coded as "male" or "female".

### SleepTrouble (categorical)
- Paritipant has told a doctor or other health professional that they had trouble sleeping. Reported in patients 16 and older. Either "yes" or "no".

### Depressed (categorical)
- Self reported number of days where participant felt down, depressed or hopeless. Reported in patients 18 and olders with categories of "none", "several", "majority (more than half the days)", or "almostall".

### Education (categorical)
- Educational level of study participant. Reported for ages 20 or older. Categories to choose from are "8thgrade", "9-11thgrade", "Highschool", "SomeCollege", or "CollegeGrad".

### Work (categorical)
- Categorizes whether study participant is "working", "not working" or no data was collected.

### HHIncomeMid (numerical)
- Total annual gross income for the household in US dollars, derived from the median of each partition. Variable was partitioned into blocks with the smallest one being (0,4999) and the largest block being (100,000 or more).

```{r echo=FALSE}
OurData <- NHANES %>% select(Age, HHIncomeMid, Testosterone, PhysActiveDays, 
                                 Pulse, Gender, SleepTrouble, Depressed, 
                                 Education, Race1, Poverty, CompHrsDay)
```

# Summary Statistics

```{r echo=FALSE}
skim(OurData) %>%
  dplyr::select(skim_variable, numeric.mean, numeric.sd, complete_rate, numeric.p50)
```

# Graphs
```{r, echo=FALSE, fig.width=3,fig.height=2}
OurData %>%
  ggplot(aes(x = PhysActiveDays)) + 
  geom_histogram()  
```

```{r, echo=FALSE, fig.width=3,fig.height=2}
OurData %>%
  ggplot(aes(x = Race1)) + 
  geom_bar() 
```

```{r, echo=FALSE, fig.width=3,fig.height=2}
OurData %>%
  ggplot(aes(x = HHIncomeMid)) + 
  geom_histogram() 
```

```{r echo=FALSE, fig.height=2, fig.width=2.5, fig.align='center'}
ggplot(OurData, aes(x= Testosterone, y = SleepTrouble)) + geom_boxplot()
```  


```{r echo=FALSE}
 OurData %>%
  lm(Pulse ~ Poverty, data = .) %>%
  ggplot(aes(x= Poverty, y=Pulse)) + 
  geom_point() + 
  geom_smooth(method= "lm", se= FALSE) 

 OurData %>%
  lm(Pulse ~ Poverty, data = .) %>%
  ggplot(aes(x=Poverty, y=Pulse)) + 
  geom_smooth(method= "lm", se= FALSE) 
```


```{r}
 OurData %>%
  lm(Pulse ~ as.factor(HHIncomeMid), data = .) %>%
  tidy()
```

```{r}
Alcohol_new <- NHANES %>%
  filter(AlcoholDay <= 40)
```

```{r}
Alcohol_new %>%
  lm(Pulse ~ AlcoholDay, data = .) %>%
  ggplot(aes(x=AlcoholDay, y=Pulse)) + 
  geom_point() + 
  geom_smooth(method= "lm", se= FALSE) 

Alcohol_new %>%
  lm(Pulse ~ AlcoholDay, data = .) %>%
  augment() %>%
  ggplot(aes(x = .fitted, y = .resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

 NHANES %>%
  lm(Pulse ~ AlcoholDay, data = .) %>%
   tidy()
```

```{r}
testosterone_new <-OurData %>%
  filter(Testosterone < 1400 ) %>%
  filter(Gender == "male")
```

```{r}
 testosterone_new %>%
  lm(Pulse ~ Testosterone, data = .) %>%
  ggplot(aes(x=Testosterone, y=Pulse)) + geom_point() + geom_smooth(method= "lm", se= FALSE) 
```
```{r}
 testosterone_new %>%
  lm(Pulse ~ Testosterone, data = .) %>%
  augment() %>%
  ggplot(aes(x = .fitted, y = .resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0)
```

```{r}
 testosterone_new %>%
  lm(Pulse ~ Testosterone, data = .) %>%
  tidy(conf.int = TRUE, conf.level = 0.95)

 testosterone_new %>%
  lm(Pulse ~ Testosterone, data = .) %>%
  glance()
```